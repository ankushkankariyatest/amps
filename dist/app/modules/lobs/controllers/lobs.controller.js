!function(){"use strict";define(["assetIt","lobs-service","lobs-config","filter-options","kendo-plugin","FeedbackTicket"],function(e){e.register.controller("lobsController",["$scope","$compile","lobsServices","$routeParams","$location","configUrl","lobsConfig","popupService",function(e,o,t,i,r,c,n,a){var d=/[^a-zA-Z0-9]/g;e.initializeController=function(){var d,r=n.getConfigs();e.config=r,e.config.detailTemplate=kendo.template($("#appTemplate").html()),e.config.detailInit=function(i){var a=i.detailRow,d=a.find(".tabstrip").kendoTabStrip({animation:{open:{effects:"fadeIn"}},select:function(d){if(d.item.textContent.indexOf("General")>-1){var r=a.find(".appList").kendoGrid(n.getSubGridConfigs()),c={name:i.data.LOB_NAME};t.getAppListByLOBName(c).then(function(e){r.data("kendoGrid").dataSource.data(e)},function(e){console.log("getAppListByProcess service failed.."+e)})}d.item.textContent.indexOf("Feedback")>-1&&o(d.contentElement)(e)}}).data("kendoTabStrip");d.select(0)},e.config.editable="popup",e.config.edit=function(e){d=angular.copy(e.model),e.container.find(".k-edit-label:last").hide(),e.container.find(".k-edit-field:last").hide(),e.sender.editable.validatable._errorTemplate=kendo.template($("#errormsg-template").html()),$(".k-edit-form-container").parents("div.k-window").addClass("k-window-custom"),c=e.model.LOB_NAME,l=e.model.DESCRIPTION};var c="",l="";e.config.save=function(e){function n(n){t.editLobs(n).then(function(e){},function(t){e.model.set("DESCRIPTION",d.DESCRIPTION)})}function i(){var t=_.find($("#grid").data("kendoGrid").dataSource.data(),{uid:e.model.uid});t.LOB_NAME=c,t.DESCRIPTION=l,$("#grid").data("kendoGrid").refresh()}var o={name:e.model.LOB_NAME,description:e.model.DESCRIPTION};a.showDeletePermissionPopup({isConfirm:n,data:o,message:"Are you sure you want to update ?",cancelUpdate:i})},t.getLobs().then(function(n){t.getAllLOBFeedbackCount().then(function(t){var i=_.object(_.pluck(t,"ID"),t);_.each(n,function(e){var t=i[e.LOB_NAME];e.COUNT=void 0===t?0:t.COUNT}),e.config.updateGrid(n)},function(t){e.config.updateGrid(n),console.log("mcps feedback Count failed.."+t)})},function(e){console.log("mcps service failed.."+e)}),i.name&&(e.filteredState=!0,e.config.pageable=!1,e.config.dataSource.filter=r.routeParamFilter(i.name))},e.updateFeedbackCount=function(e,t){angular.forEach($("#grid").data().kendoGrid.dataSource.data(),function(n){n.LOB_NAME==e&&(n.COUNT=t)});var n=$(".feedbackCount"+e.replace(d,"_"));n.html(t),n.parent().removeClass("hide")},e.filterGridRecord=function(t){var i=n.getConfigs();e.filterGrid(t,i.getDefaultFilterWithFilterText(t))}}])})}();