!function(e,t){"use strict";define(["assetIt","app-config","kendo-plugin","app-infra-tab","applicationService","ticket-service"],function(t){t.register.controller("bacrController",["$scope","$rootScope","$location","appConfig","authenticationFactory","applicationService","FeedbackTicketService","popupService",function(t,n,r,o,a,s,c,i){t.initController=function(){var e=o.getBacrConfigs();t.bacrConfig=e,t.appData=o.getApplication(),t.comment=!t.appData.comment&&t.appData.oldData?"No Comments found":t.appData.comment,t.obj={comment:void 0==t.comment?"":t.comment},t.showInfrastructure=a.userRole.indexOf(a.userRoles.enterprise)>-1,n.certifyStatus={},t.totalCount=250,t.remainingCount=250},t.updateCount=function(){t.remainingCount=t.obj.comment.length>=t.totalCount?0:t.totalCount-t.obj.comment.length,t.obj.comment=t.obj.comment.substring(0,t.totalCount)},t.certify=function(e){n.status=e;var d=a.lanid,u=t.getLanfromValue(t.appData.CLIENT_OWNER),p=t.getLanfromValue(t.appData.IT_LEAD),l=u==d?"Client Owner":"other";l=p==d?"IT Lead":l;var f={data:o.getApplication(),createdBy:a.user,context:"APPLICATION",id:t.appData.APP_ID,comments:t.obj.comment,role:l,status:e};if(s.certifyApplication(f).then(function(e){n.certifyStatus=e,i.showCertifySuccess()},function(){i.showCertifyError()}),"0"===e){var m={context:"APPLICATION",id:t.appData.APP_ID,page:r.absUrl(),mood:"happy",message:t.obj.comment,status:"submitted"};c.post(m)}},t.getLanfromValue=function(e){return null!=e&&void 0!==e&&"undefined"!=e?e.substring(e.lastIndexOf("(")+1,e.lastIndexOf(")")):""},t.exportPageToPDf=function(){e(".notForPdf").hide(),kendo.drawing.drawDOM(e("#bacrView")).then(function(e){return kendo.drawing.exportPDF(e,{paperSize:"auto",margin:{left:"1cm",top:"1cm",right:"1cm",bottom:"1cm"}})}).done(function(t){kendo.saveAs({dataURI:t,fileName:"AM4IT-Business-Application-Configuration-Report.pdf",proxyURL:"#/"}),e(".notForPdf").show()})}}]),t.register.controller("appSystemInfoController",["$scope","$rootScope","messageInfo","$location","$compile","authenticationFactory","infraInfoModel","popupService",function(a,e,n,r,l,s,t,c){var o={context:"APP-OnBoarding",id:a.appId,page:r.absUrl(),mood:"New Infra",message:"",status:"submitted"},i={id:a.appId,context:"APP-OnBoarding",email:s.user,data:"",status:"submitted"};a.initCtrl=function(){t.clearData(),e.showOnboard=!1},e.verifyOnboardData=function(){var e={onboardingDetails:t.getData()};c.showOnboardingPopup("app/modules/application/templates/appInfo/onboarding-details.html",e)},e.postOnboardData=function(){var a=JSON.stringify({onboardingDetails:t.getData()});o.message=a,i.data=a,n.insertOnboardingInfo(i),n.postTicket(o),t.clearData(),e.showOnboard=!1}}]),t.register.factory("infraInfoModel",function(){var e={};return e.infra={},e.getData=function(e){return this.infra},e.clearData=function(){this.infra={}},e.setData=function(e){this.infra=e},e.addData=function(e){var t={Request_ID:e.Request_ID,BEDatasetId:e.BEDatasetId,BEReconciliationIdentity:e.BEReconciliationIdentity,BEName:e.BEName,RELDatasetId:e.RELDatasetId,RELSourceReconciliationIdentity:e.RELSourceReconciliationIdentity,RELName:e.RELName,RELSource:e.RELSource,BEInstanceId:e.BEInstanceId,BDAssetClass:e.BDAssetClass,BEAssetID:e.BEAssetID,BEClassId:e.BEClassId,BEDescription:e.BEDescription,BESerialNumber:e.BESerialNumber,BEShortDescription:e.BEShortDescription,RELAsset_Class_Id:e.RELAsset_Class_Id,RELAsset_Instance_ID:e.RELAsset_Instance_ID,RELAssetReconciliationIdentity:e.RELAssetReconciliationIdentity,RELClass_Id:e.RELClass_Id,RELInstance_Id:e.RELInstance_Id,RELModel:e.RELModel,RELRelationshipName:e.RELRelationshipName,RELUser_Display_Object_Name:e.RELUser_Display_Object_Name,RELVersionNumber:e.RELVersionNumber},a=e.uid;this.infra[a]=t},e}),t.register.factory("messageInfo",["FeedbackTicketService","appInfraService","$timeout",function(n,o,t){var a={};return a.insertOnboardingInfo=function(a){o.insertOnboardingInfo(a).then(function(o){var a=e(".isa_success");a.css("display","block");var n=e("#successInfo");n.html("Successfully generated a ticket for this Request"),t(function(){a.css("display","none"),n.html("")},3e3)},function(o){var a=e(".isa_error");a.css("display","block");var n=e("#errorInfo");n.html("Not able to submit ticket for this request. Please try later"),t(function(){a.css("display","none"),n.html("")},3e3)})},a.postTicket=function(a){n.post(a).then(function(o){var a=e(".isa_success");a.css("display","block");var n=e("#successInfo");n.html("Successfully generated a ticket for this Request"),t(function(){a.css("display","none"),n.html("")},3e3)},function(o){var a=e(".isa_error");a.css("display","block");var n=e("#errorInfo");n.html("Not able to submit ticket for this request. Please try later"),t(function(){a.css("display","none"),n.html("")},3e3)})},a}]),t.register.directive("crudKendoGrid",["$rootScope","appInfraService","messageInfo","$location","$timeout","infraInfoModel",function(n,t,i,o,r,a){return{restrict:"AE",scope:{key:"@",type:"@"},link:function(i,r,u){function s(){t.createInfraEnvironmentView(i.key).then(function(t){if(t.isSuccess){var a=[];e.each(t.response,function(n,e){var t="RELSource.ReconciliationIdentity";void 0!==e[t]&&(e.RELSourceReconciliationIdentity=e[t],delete e[t]),a.push(e)}),r.data("kendoGrid").dataSource.data(a)}})}function c(){t.getInfraPendingApprovalView(i.key).then(function(t){var n=[];t.response&&t.response.length>0&&e.each(t.response,function(o,t){var a=e.parseJSON(t.DATA);n.push(a)}),a.setData(n),r.data("kendoGrid").dataSource.data(n)})}({context:"APP-OnBoarding",id:i.key,page:o.absUrl(),mood:"Correct",message:"",status:"submitted"});r.kendoGrid({dataSource:new kendo.data.DataSource({pageSize:20,schema:{model:{id:"Request_ID",fields:{BEAssetID:{type:"string",validation:{required:!0}},BDAssetClass:{type:"string",validation:{required:!0}},RELUser_Display_Object_Name:{type:"string",validation:{required:!0}},RELName:{type:"string",validation:{required:!0}},RELModel:{type:"string",validation:{required:!0}},RELVersionNumber:{type:"string",validation:{required:!0}},RELSource:{type:"string",validation:{required:!0}}}}},data:[]}),allowCopy:!0,batch:!0,autoBind:!0,scrollable:!0,groupable:!1,selectable:!1,resizable:!0,height:400,filterable:!1,pageable:{refresh:!1,input:!0,numeric:!1,pageSize:20,pageSizes:[20,50,100,200]},editable:"inline",toolbar:["create"],columns:[{field:"BDAssetClass",title:"Asset"},{field:"RELUser_Display_Object_Name",title:"Asset Object"},{field:"RELName",title:"Name"},{field:"RELModel",title:"Model"},{field:"RELVersionNumber",title:"OS Version"},{command:[{name:"edit"}]}],save:function(e){n.showOnboard=!0,"$apply"!=i.$root.$$phase&&"$digest"!=i.$root.$$phase&&i.$apply(),a.addData(e.model)},update:function(e){return!0}}).data("kendoGrid");var l={General:{callSvc:s},"Reported Ticket":{callSvc:c}},d=l[i.type];d.callSvc()}}}])})}($,angular);