!function(e){"use strict";define(["assetIt","versionService"],function(e){e.register.directive("versionCompare",["versionService",function(e){return{restrict:"AE",templateUrl:"app/modules/site-utility-version-diff/templates/version-compare.html",link:function(e,t,o){},controller:["$scope",function(o){var t=this,a=["ChangeLog","EACMS","PACS"];t.limitToCounter=20,t.limitOuter=20,t.fromDateObject=null,t.toDateObject=null,t.maxDate=new Date,t.changeExists=!0,t.fromDateChanged=function(){t.toDateObject=null,t.toDateString=null},t.toDateChanged=function(){},t.showDiff=function(){var o=this,r=angular.copy(o.toDateObject);r.setDate(r.getDate()+1);var a={sheet:o.selectedSheet,fromVersion:o.fromDateObject.getTime(),toVersion:r.getTime()};if(a.sheet&&a.fromVersion&&a.toVersion){var n=_.find(t.sheetNameAndLatestVersion,{sheetName:o.selectedSheet});t.cols=n.masterheaders,e.getSheetData(a).then(function(e){t.historyRowData=e.data,t.fromDateResp=o.fromDateObject,t.toDateResp=o.toDateObject,t.summaryCountFrom=e.countFrom,t.summaryCountTo=e.countTo,t.primaryKeys=n.primaryKey,t.selectedSheetName=n.displayName})}},t.loadImportRecord=function(t){t.showLoading=!0;var o=this,a={sheetName:o.selectedSheet,startTime:t.startTime};e.getImportRecord(a).then(function(e){t.dataObject=e,t.showLoading=!1},function(e){t.showLoading=!1,t.error=e})},t.loadDiffData=function(t){t.showLoading=!0;var o=this,a={};_.each(o.primaryKeys,function(e,o){a[e]=t.recordData[e]});var r={sheetName:o.selectedSheet,version:t.version,key:a};e.getDiffData(r).then(function(e){e=_.sortBy(e,"version").reverse(),2===e.length&&(t.isReAdded=e[1].isRemoved,t.comparerKeys=_.union(Object.keys(e[0].recordData),Object.keys(e[1].recordData)),t.currentData=e[0].recordData,t.previousData=e[1].recordData),t.showLoading=!1},function(e){t.showLoading=!1,t.error=e})},e.getSheetNameAndLatestVersion().then(function(e){t.sheetNameAndLatestVersion=o.sheetData=_.filter(e,function(e,t){return-1===$.inArray(e.sheetName,a)})},function(e){t.sheetNameAndLatestVersion=[]}),o.diff=t}]}}])})}(angular);