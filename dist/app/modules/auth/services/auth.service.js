!function(){"use strict";define(["angularAMD","authentication-factory","auth-model"],function(){var e=angular.module("assetItAuthentication");e.factory("authService",["$q","$location","$http","configUrl","authenticationFactory","loginModel","registerModel","forgotPasswordModel","resetPasswordModel","loadingData","svcStorage",function(c,r,a,n,s,g,m,f,h,o,u){var e={},i={isSuccess:!1,message:"Oops! Got an error. Try again"},l=function(e,r){if(n.sendErrorInMail){var t={from:"am4it@wizni.com",to:n.errorEmailReceipient,subject:"AMPS Front End Error",html:"Request <br />"+JSON.stringify(e)+"<br /><br/>Response <br />"+JSON.stringify(r)};a({url:n.baseServiceUrl+"sendemail",method:"POST",data:t}).then()}},t=function(e){o.start(),e.url=n.authServiceUrl+e.url,e.cache=!1;var r=c.defer();return a(e).success(function(e){o.stop(),r.resolve(e)}).error(function(t){o.stop(),l(e,t),r.reject(t)}),r.promise},d=function(e,i,f,d){e.url=n.authServiceUrl+e.url,e.cache=!1;var t=e.url,s=u.get(t),r=c.defer();return s?r.resolve(s):(o.start(),a(e).success(function(e){o.stop(),u.put(t,e),r.resolve(e)}).error(function(t,s,n,i){o.stop(),l(e,t),r.reject(t)})),r.promise};return e.login=function(){var r=g.getModel(),o=/(.*)@.*/.exec(r.username);o&&o.length||(r.username+="@pge.com");var n={method:"POST",url:"loginViaActiveDirectory",data:JSON.stringify(r)},e=c.defer();return t(n).then(function(r){r.isSuccess?(s.isLogged=!0,s.setInfo(r),e.resolve(r)):(s.clearInfo(),e.reject(r))},function(r){e.reject(i)}),e.promise},e.logout=function(){if(s.isLogged){var e={method:"POST",url:"logout",data:JSON.stringify({username:s.user})};n.authServiceUrl+"logout";t(e).then(function(e){},function(e){}),s.clearInfo(),r.path("/login")}},e.register=function(s){var o=r.absUrl().replace(r.path(),""),e=m.getModel(),n=/(.*)@.*/.exec(e.username);n&&n.length||(e.username+="@pge.com"),e.url=o+"/confirmUser/",e.requestAdmin&&(e.urlAdmin=o+"/adminAccess/");var a={method:"POST",url:"registerViaActiveDirectory",data:JSON.stringify(e)};t(a).then(function(e){e.isSuccess?r.path("/successAction/register"):s(e)},function(e){s(i)})},e.registerADUser=function(e){var s=r.absUrl().replace(r.path(),"");return e.url=s+"/confirmUser/",e.requestAdmin&&(e.urlAdmin=s+"/adminAccess/"),t({method:"POST",url:"registerViaActiveDirectory",data:JSON.stringify(e)})},e.forgotPassword=function(e){var o=r.absUrl().replace(r.path(),""),s=f.getModel();s.url=o+"/resetPassword/";var n={method:"POST",url:"forgotPassword",data:JSON.stringify(s)};t(n).then(function(t){t.isSuccess?r.path("/successAction/forgotPassword"):e(t)},function(r){e(i)})},e.resetPassword=function(s,e){var o=h.getModel(),n={method:"POST",url:"resetPassword/"+s,data:JSON.stringify(o)};t(n).then(function(t){t.isSuccess?r.path("/successAction/resetPassword"):e(t)},function(r){e(i)})},e.checkResetLink=function(e){var r={method:"GET",url:"resetPassword/"+e};return t(r)},e.confirmUser=function(e){var r={method:"GET",url:"confirmEmail/"+e};return t(r)},e.adminAccess=function(e){var r={method:"GET",url:"adminAccess/"+e};return t(r)},e.getSplashData=function(){var e="announcement",r={method:"get",url:e};return d(r)},{login:e.login,logout:e.logout,register:e.register,registerADUser:e.registerADUser,forgotPassword:e.forgotPassword,resetPassword:e.resetPassword,checkResetLink:e.checkResetLink,adminAccess:e.adminAccess,confirmUser:e.confirmUser,getSplashData:e.getSplashData}}])})}();