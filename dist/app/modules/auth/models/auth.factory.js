!function(){"use strict";define(["angularAMD"],function(){var e=angular.module("assetItAuthentication",[]);e.factory("authenticationFactory",["$cacheFactory","$window","userRoles",function(o,e,t){var r={isLogged:!1,fullName:"",user:"",userRole:[],userRoles:t,isAuthenticated:!1,workOrder:"",check:function(){e.localStorage.token&&e.localStorage.user?this.isLogged=!0:(this.isLogged=!1,delete this.user)},setInfo:function(t){this.fullName=t.user.username,this.user=t.user.email,this.lanid=t.user.LAN_ID,this.userRole=t.user.roles,this.workOrder=t.user.workOrder,e.localStorage.token=t.token,e.localStorage.fullName=this.fullName,e.localStorage.user=this.user,e.localStorage.lanid=this.lanid,e.localStorage.userRole=this.userRole?JSON.stringify(this.userRole):"",e.localStorage.workOrder=this.workOrder},setAuthInfoFromStorage:function(){this.fullName=e.localStorage.fullName,this.user=e.localStorage.user,this.lanid=e.localStorage.lanid;try{this.userRole=JSON.parse(e.localStorage.userRole)}catch(t){this.userRole=[]}this.workOrder=e.localStorage.workOrder},clearInfo:function(){this.isLogged=!1,this.isAuthenticated=!1,delete this.fullName,delete this.user,delete this.lanid,delete this.userRole,delete this.workOrder,delete e.localStorage.fullName,delete e.localStorage.token,delete e.localStorage.user,delete e.localStorage.lanid,delete e.localStorage.userRole,delete e.localStorage.workOrder,e.currentRoute=void 0},isValidToken:function(){return e.localStorage.token},getAuthToken:function(){return"Bearer "+e.localStorage.token},getUserName:function(){return e.localStorage.user},setWorkOrder:function(t){e.localStorage.workOrder=t,this.workOrder=t}};return r}]),e.factory("tokenInterceptor",["$q","$location","authenticationFactory",function(t,r,e){return{request:function(t){return t.headers=t.headers||{},e.isValidToken()&&(t.headers.Authorization=e.getAuthToken()),t},requestError:function(e){return t.reject(e)},response:function(r){return null!=r&&200==r.status&&e.isValidToken()&&!e.isAuthenticated&&(e.isAuthenticated=!0),r||t.when(r)},responseError:function(o){return null!=o&&403===o.status&&(e.isValidToken()||e.isAuthenticated)&&(e.clearInfo(),e.isAuthenticated=!1,r.path("/login")),t.reject(o)}}}])})}();