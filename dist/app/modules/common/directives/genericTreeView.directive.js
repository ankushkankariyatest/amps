!function(){"use strict";define(["assetIt","sites-services"],function(e){e.register.directive("genericTreeView",["sitesServices",function(e){return{restrict:"AE",template:'<div class="input-group input-group-sm assetIT-main-left_pane_search_control">                            <input id="treeSearch" type="text" class="form-control" ng-model="treeSearch" placeholder="Search..." aria-describedby="search field">                            <span class="filter-site-clear"></span>                            <span class="input-group-btn">                                <button class="btn btn-primary" type="button"><i class="glyphicon glyphicon-search"></i></button>                            </span>                        </div>                        <div class="tree-view-info site-tree-view-nav-scroller"></div>',scope:{updateView:"&",updateTreeData:"=",treeModel:"="},link:function(e,t,a){function n(i){if(i.length>0){var e=t.find(".tree-view-info");e.data("kendoTreeView").dataSource.data(i),e.data("kendoTreeView").select(e.find(".k-item").first()),e.data("kendoTreeView").trigger("select",{node:e.find(".k-item").first()})}}function r(){var r=t.find(".tree-view-info").data("kendoTreeView");r.expand(".k-item");var n=$.trim(e.treeSearch),l=r.dataSource.data();if(2!=r.options.dataTextField.length||i)r.dataSource.filter({field:e.treeModel.filterText,operator:"FACL_ID"==e.treeModel.filterText?"eq":"contains",value:n});else{var o=e.treeModel.filterOptions,a={};a.nodeFilter={logic:"and",filters:[]},"All"!=o.activeSiteType&&a.nodeFilter.filters.push({field:"SITE_TYP",operator:"contains",value:o.activeSiteType}),_.each(l,function(e,t){e.children.filter({field:"CYBER_SYSTEM_NAME",operator:"contains",value:n})}),a.nodeFilter.filters.push({field:"FACL_ID",operator:"eq",value:n},{field:"SITE_NM",operator:"contains",value:n}),t.find(".tree-view-info").find(".k-group .k-group .k-in").closest("li").hide();var c=t.find(".tree-view-info").find(".k-group .k-group .k-in:contains('"+n+"')");c.each(function(){$(this).closest("ul").show(),$(this).closest("li").show()}),r.dataSource.filter(a.nodeFilter)}i=!1}$.fn.extend({treed:function(e){var r="",i="";"undefined"!=typeof e&&("undefined"!=typeof e.openedClass&&(r=e.openedClass),"undefined"!=typeof e.closedClass&&(i=e.closedClass));var t=$(this);t.addClass("tree"),t.find("li").has("ul").each(function(){var e=$(this);e.prepend("<i class='indicator glyphicon "+i+"'></i>"),e.addClass("branch"),e.on("click",function(n){if(this==n.target){var a=$(this).children("i:first");$(this).children().children().toggle();var t=e.siblings("li");t.removeClass("active"),t.find("ul li").css("display","none"),t.find("i").removeClass(r),t.find("i").addClass(i),$(this).addClass("active"),a.toggleClass(r+" "+i)}}),e.children().children().toggle()}),t.find(".branch .indicator").on("click",function(){$(this).closest("li").click()}),t.find(".branch>a").on("click",function(e){$(this).closest("li").click(),e.preventDefault()}),t.find(".branch>button").on("click",function(e){$(this).closest("li").click(),e.preventDefault()})}}),t.find(".tree-view-info").kendoTreeView({animation:!1,dataSource:e.treeModel.datasource,select:function(r){r.preventDefault();var t=r.node,n=this.parent(t),i=n.length>0,a=r.sender.dataItem(t),o=i?t.textContent:this.text(t),l=i?this.text(n):"",c={hasParentNode:i,parent:{hasParent:i,parentText:l},activeNode:a,nodeValue:o};this.select(t),e.updateView()(c)},dataTextField:e.treeModel.dataTextField}),t.find("#treeSearch").bind("input propertychange",function(t){void 0!=e.treeSearch&&(e.treeSearch=$.trim(t.currentTarget.value),r())}),e.treeModel.updateTreeView=function(e){n(e)};var i=!1;e.treeModel.filterTreeSearch=function(t){e.treeSearch=t,i=!0,r()},e.$watch("treeModel.filterOptions",function(i,a){if(void 0!==i&&i!=a){var r=i,e=t.find(".tree-view-info").data("kendoTreeView");e.select($()),"All"!=r.activeSiteType?e.dataSource.filter({field:"SITE_TYP",operator:"contains",value:r.activeSiteType}):e.dataSource.filter({});var n=t.find(".tree-view-info .k-item").first();e.select(n),e.trigger("select",{node:n})}},!0),t.find(".filter-site-clear").bind("click",function(a){if(void 0!==e.treeSearch&&""!=e.treeSearch.trim()){var i=t.find(".tree-view-info").data("kendoTreeView");i.collapse(".k-item");var r=e.treeModel.filterOptions;void 0!==r&&"undefined"!=r&&"All"!=r.activeSiteType?i.dataSource.filter({field:"SITE_TYP",operator:"contains",value:r.activeSiteType}):i.dataSource.filter({}),e.treeSearch="",i.select($());var n=t.find(".tree-view-info .k-item").first();i.select(n),i.trigger("select",{node:n}),"$digest"!=e.$$phase&&e.$digest()}}),t.find("#treeSearch").bind("click",function(e){e.stopPropagation()})}}}])})}();