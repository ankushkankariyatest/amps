!function(e){"use strict";e(["assetIt","GlobalFilters","ticket-service"],function(e){e.register.constant("FEEDBACK_TICKET_CONTSTANT",{MOOD:{HAPPY:"happy"},STATUS:{SUBMITTED:"submitted"}}),e.register.filter("showNFeedback",function(){return function(e,t){return!t||e.length<=t?e:e.slice(0,t)}}),e.register.filter("remainingCount",function(){return function(e,t){var c=e?t-e:t;return 0>c?0:c}}),e.register.directive("maxTextCount",[function(){return{require:"ngModel",scope:{text:"=ngModel"},link:function(e,c,n){var t=n.maxTextCount;c.bind("keyup",function(){e.text.length>t&&(e.text=e.text.substring(0,t),"$apply"!=e.$root.$$phase&&"$digest"!=e.$root.$$phase&&e.$apply())})}}}]),e.register.filter("getFirstPartOfEmail",function(){return function(e){return e?e.split("@")[0]:"-"}}),e.register.controller("FeedbackTicketController",["$scope","FeedbackTicketService","$location","FEEDBACK_TICKET_CONTSTANT","loadingData",function(t,n,r,i,c){c.start();var e=this;e.initialShowingFeedbackCount=2,n.get(t.appId,t.context).then(function(t){e.feedbackTickets=t,c.stop()},function(t){e.addFeedbackTicketErrorMessage=t.ErrorKey,console.log("Error",t),c.stop()}),e.post=function(){if(e.newFeedbackTicket&&!e.isAddingNewFeedbackTicket&&""!=e.newFeedbackTicket.trim()){c.start(),e.isAddingNewFeedbackTicket=!0,e.addFeedbackTicketErrorMessage=void 0;var o={context:t.context,id:t.appId,page:r.absUrl(),mood:i.MOOD.HAPPY,message:e.newFeedbackTicket.trim(),status:i.STATUS.SUBMITTED};n.post(o,"false"==t.noWorkOrder?!1:!0).then(function(n){e.feedbackTickets.push(n.response),e.isAddingNewFeedbackTicket=!1,e.newFeedbackTicket="",t.$evalAsync(t.updateFeedbackCount()(t.appId,e.feedbackTickets.length)),c.stop()},function(t){e.isAddingNewFeedbackTicket=!1,e.addFeedbackTicketErrorMessage=t.ErrorKey,e.newFeedbackTicket="",c.stop()}),e.isEditorVisible=!1}else e.addFeedbackTicketErrorMessage="Please Enter Feedback"},e.cancel=function(){e.newFeedbackTicket="",e.addFeedbackTicketErrorMessage="",e.isEditorVisible=!1}}]),e.register.directive("feedbackTicket",function(){return{restrict:"E",scope:{appId:"@",context:"@",updateFeedbackCount:"&",noWorkOrder:"@"},templateUrl:"app/modules/common/templates/feedbackTicket.html",controller:"FeedbackTicketController",controllerAs:"feedbackTicketCtrl"}}),e.register.controller("FeedbackTicketCommentController",["$scope","FeedbackTicketService","loadingData",function(t,n,c){var e=this;e.cancel=function(){e.newFeedbackTicketComment="",e.addFeedbackTicketCommentErrorMessage="",t.isAddingFeedback=!1},e.post=function(){if(e.newFeedbackTicketComment&&!e.isAddingNewFeedbackTicketComment&&""!=e.newFeedbackTicketComment.trim()){c.start(),e.isAddingNewFeedbackTicketComment=!0,e.addFeedbackTicketCommentErrorMessage=void 0;var i={feedback_id:t.feedbackId,workOrder:t.workOrderId,context:t.context,id:t.appId,description:e.newFeedbackTicketComment.trim()};n.postComment(i).then(function(n){t.comments&&t.comments.length||(t.comments=[]),t.comments.push(n.response),e.isAddingNewFeedbackTicketComment=!1,e.newFeedbackTicketComment="",t.isAddingFeedback=!1,c.stop()},function(t){e.isAddingNewFeedbackTicketComment=!1,e.addFeedbackTicketCommentErrorMessage=t.ErrorKey,e.newFeedbackTicketComment="",c.stop()})}else e.addFeedbackTicketCommentErrorMessage="Please Enter Comment"}}]),e.register.directive("feedbackTicketComment",function(){return{restrict:"E",scope:{feedbackId:"@",appId:"@",context:"@",workOrderId:"@",isAddingFeedback:"=",comments:"="},replace:!0,templateUrl:"app/modules/common/templates/feedbackTicketComment.html",controller:"FeedbackTicketCommentController",controllerAs:"feedbackTicketCommentCtrl"}})})}(define);