!function(){"use strict";define(["assetIt","jquery","typeahead"],function(e,t){e.register.directive("sfTypeahead",["$location",function(e){return{restrict:"AC",require:"?ngModel",scope:{options:"=",datasets:"=",suggestionKey:"@"},template:'<input type="text" class="form-control" />',link:function(a,n,l,i){function o(){if(s)n.typeahead(a.options,a.datasets),s=!1;else{var e=n.val();n.typeahead("destroy"),n.typeahead(a.options,a.datasets),i.$setViewValue(e),n.triggerHandler("typeahead:opened")}}function p(t,a){var e=-1;return angular.forEach(t,function(t,n){angular.equals(a,t)&&(e=n)}),e>=0}function r(n,e,t){a.$apply(function(){var t=angular.isDefined(a.suggestionKey)?e[a.suggestionKey]:e;i.$setViewValue(t)}),c(e,t)}var d=a.options||{},u=(angular.isArray(a.datasets)?a.datasets:[a.datasets])||[],s=!0;o(),a.$watch("options",o),angular.isArray(a.datasets)?a.$watchCollection("datasets",o):a.$watch("datasets",o),i.$parsers.push(function(e){var t=angular.isObject(e);return d.editable===!1?(i.$setValidity("typeahead",t),t?e:void 0):e}),i.$formatters.push(function(e){if(angular.isObject(e)){var o=!1;return t.each(u,function(l,r){function c(t){var r=p(t,e);r?(i.$setViewValue(e),o=!0):i.$setViewValue(d.editable===!1?void 0:e),(o||l===u.length-1)&&setTimeout(function(){a.$apply(function(){n.typeahead("val",s)})},0)}var y=r.source,t=r.displayKey||"value",s=(angular.isFunction(t)?t(e):e[t])||"";return o?!1:s?void y(s,c):void c([])}),""}return null==e&&n.typeahead("val",null),e});var c=function(t,n){var i={apps:{location:"/applications/"+t.APP_ID},mcps:{location:"/mcps/"+t.CODE},lobs:{location:"/lobs/"+t.LOB_NAME}},o=i[n].location;e.path(o),"$apply"!=a.$root.$$phase&&"$digest"!=a.$root.$$phase&&a.$apply()};n.bind("typeahead:selected",function(n,e,t){r(n,e,t),a.$emit("typeahead:selected",e,t)}),n.bind("typeahead:autocompleted",function(n,e,t){r(n,e,t),a.$emit("typeahead:autocompleted",e,t)}),n.bind("typeahead:opened",function(){a.$emit("typeahead:opened")}),n.bind("typeahead:closed",function(){a.$emit("typeahead:closed")}),n.bind("typeahead:cursorchanged",function(e,t,n){a.$emit("typeahead:cursorchanged",e,t,n)})}}}])})}();