/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */

!function(){"use strict";define(["assetIt","jszip","pako_deflate"],function(e,t){window.JSZip=t,e.register.service("exportUtil",["$location",function(o){var e=function(){var e=new Date;return"AMPS"+o.path()+(e.getMonth()+1)+"/"+e.getDate()+"/"+e.getFullYear()},n=function(t){var o=e();t.dataSource.pageSize();t.dataSource.pageSize(t.dataSource.total()),t.options.pdf={fileName:o+".pdf",proxyURL:"/proxy",allPages:!0},t.saveAsPDF()},r=function(t,o){var n=e(),r={fileName:n+".xlsx",proxyURL:"/proxy",allPages:!0,filterable:!1};t.options.excel=angular.extend(r,o),t.saveAsExcel()},a=function(){var o=e()+".xlsx",t=$("#grid").data("kendoGrid");t.options.excel={fileName:o,proxyURL:"/proxy",allPages:!0,filterable:!1},t.saveAsExcel()},i=function(o){var p=o.dataSource.pageSize(),r="",v=e()+".csv";o.dataSource.pageSize(o.dataSource.data().length);for(var s=o.dataSource.view(),n=0;n<o.columns.length;n++){var f=o.columns[n].field,c=o.columns[n].title||f;f&&(c=c.replace(/"/g,'""'),r+='"'+c+'"',n<o.columns.length-1&&(r+=","))}r+="\n";for(var u in s){for(var n=0;n<o.columns.length;n++){var i=o.columns[n].field;o.columns[n].template,o.columns[n].exportFormat;if(i){var a="";if(i.indexOf(".")>=0)for(var d=i.split("."),a=s[u]||"",l=0;l<d.length;l++){var g=d[l];a=a[g]||""}else a=s[u][i]||"";a=a.toString().replace(/"/g,'""'),r+='"'+a+'"',n<o.columns.length-1&&(r+=",")}}r+="\n"}o.dataSource.pageSize(p);var m=new Blob([r],{type:"text/csv;charset=utf-8"});t(m,v)},c=function(){var t=$("#grid").data("kendoGrid"),p=t.dataSource.pageSize(),r="";e()+".csv";t.dataSource.pageSize(t.dataSource.view().length);for(var a=t.dataSource.view(),o=0;o<t.columns.length;o++){var f=t.columns[o].field,s=t.columns[o].title||f;f&&(s=s.replace(/"/g,'""'),r+='"'+s+'"',o<t.columns.length-1&&(r+=","))}r+="\n";for(var i in a){for(var o=0;o<t.columns.length;o++){var l=t.columns[o].field,c=t.columns[o].template,v=t.columns[o].exportFormat;if(l){var n="";if(l.indexOf(".")>=0)for(var d=l.split("."),n=a[i]||"",u=0;u<d.length;u++){var g=d[u];n=n[g]||""}else n=a[i][l]||"";n&&c&&v!==!1&&(n=_.isFunction(c)?c(a[i]):kendo.template(c)(a[i])),n=n.toString().replace(/"/g,'""'),r+='"'+n+'"',o<t.columns.length-1&&(r+=",")}}r+="\n"}t.dataSource.pageSize(p),window.open("data:text/csv;charset=utf-8,"+escape(r))},t=t||"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob&&navigator.msSaveOrOpenBlob.bind(navigator)||function(e){if("undefined"==typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var s=e.document,r=function(){return e.URL||e.webkitURL||e},o=s.createElementNS("http://www.w3.org/1999/xhtml","a"),v="download"in o,d=function(o){var t=s.createEvent("MouseEvents");t.initMouseEvent("click",!0,!1,e,0,0,0,0,0,!1,!1,!1,!1,0,null),o.dispatchEvent(t)},n=e.webkitRequestFileSystem,l=e.requestFileSystem||n||e.mozRequestFileSystem,m=function(t){(e.setImmediate||e.setTimeout)(function(){throw t},0)},c="application/octet-stream",u=0,g=500,a=function(t){var o=function(){"string"==typeof t?r().revokeObjectURL(t):t.remove()};e.chrome?o():setTimeout(o,g)},i=function(t,e,r){e=[].concat(e);for(var o=e.length;o--;){var n=t["on"+e[o]];if("function"==typeof n)try{n.call(t,r||t)}catch(a){m(a)}}},f=function(s,p){var f,S,y,t=this,w=s.type,h=!1,x=function(){i(t,"writestart progress write writeend".split(" "))},g=function(){if((h||!f)&&(f=r().createObjectURL(s)),S)S.location.href=f;else{var o=e.open(f,"_blank");void 0==o&&"undefined"!=typeof safari&&(e.location.href=f)}t.readyState=t.DONE,x(),a(f)},m=function(e){return function(){return t.readyState!==t.DONE?e.apply(this,arguments):void 0}},E={create:!0,exclusive:!1};return t.readyState=t.INIT,p||(p="download"),v?(f=r().createObjectURL(s),o.href=f,o.download=p,d(o),t.readyState=t.DONE,x(),void a(f)):(/^\s*(?:text\/(?:plain|xml)|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(s.type)&&(s=new Blob(["\ufeff",s],{type:s.type})),e.chrome&&w&&w!==c&&(y=s.slice||s.webkitSlice,s=y.call(s,0,s.size,c),h=!0),n&&"download"!==p&&(p+=".download"),(w===c||n)&&(S=e),l?(u+=s.size,void l(e.TEMPORARY,u,m(function(e){e.root.getDirectory("saved",E,m(function(e){var o=function(){e.getFile(p,E,m(function(e){e.createWriter(m(function(o){o.onwriteend=function(o){S.location.href=e.toURL(),t.readyState=t.DONE,i(t,"writeend",o),a(e)},o.onerror=function(){var e=o.error;e.code!==e.ABORT_ERR&&g()},"writestart progress write abort".split(" ").forEach(function(e){o["on"+e]=t["on"+e]}),o.write(s),t.abort=function(){o.abort(),t.readyState=t.DONE},t.readyState=t.WRITING}),g)}),g)};e.getFile(p,{create:!1},m(function(e){e.remove(),o()}),m(function(e){e.code===e.NOT_FOUND_ERR?o():g()}))}),g)}),g)):void g())},t=f.prototype,p=function(e,t){return new f(e,t)};return t.abort=function(){var e=this;e.readyState=e.DONE,i(e,"abort")},t.readyState=t.INIT=0,t.WRITING=1,t.DONE=2,t.error=t.onwritestart=t.onprogress=t.onwrite=t.onabort=t.onerror=t.onwriteend=null,p}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);return{exportToPdf:n,exportToExcel:r,exportToCsv:i,exportKendoGridToExcel:a,exportKendoGridToCsv:c}}])})}();