!function(){"use strict";define(["assetIt","mcps-service","mcps-config","filter-options","kendo-plugin","FeedbackTicket"],function(e){e.register.controller("mcpsController",["$scope","$compile","mcpsServices","$routeParams","$location","configUrl","mcpsConfig","popupService",function(e,n,t,o,d,c,i,a){e.initializeController=function(){var d,c=i.getConfigs();e.config=c,e.config.detailTemplate=kendo.template($("#appTemplate").html()),e.config.detailInit=function(o){var a=o.detailRow,d=a.find(".tabstrip").kendoTabStrip({animation:{open:{effects:"fadeIn"}},select:function(d){if(d.item.textContent.indexOf("General")>-1){var c=a.find(".appList").kendoGrid(i.getSubGridConfigs());t.getAppListByProcess(o.data.CODE).then(function(e){c.data("kendoGrid").dataSource.data(e)},function(e){console.log("getAppListByProcess service failed.."+e)})}d.item.textContent.indexOf("Feedback")>-1&&n(d.contentElement)(e)}}).data("kendoTabStrip");d.select(0)},e.config.editable="popup",e.config.edit=function(e){d=angular.copy(e.model),e.container.find(".k-edit-label:last").hide(),e.container.find(".k-edit-field:last").hide(),e.sender.editable.validatable._errorTemplate=kendo.template($("#errormsg-template").html()),$(".k-edit-form-container").parents("div.k-window").addClass("k-window-custom"),r=e.model.CODE,l=e.model.DESCRIPTION,f=e.model.BUSINESS_CONTACT,s=e.model.BUSINESS_CONTINUITY};var r="",l="",f="",s="";e.config.save=function(e){function i(i){t.editProcess(i).then(function(e){},function(t){e.model.set("DESCRIPTION",d.DESCRIPTION),e.model.set("BUSINESS_CONTACT",d.BUSINESS_CONTACT),e.model.set("BUSINESS_CONTINUITY",d.BUSINESS_CONTINUITY)})}function o(){var t=_.find($("#grid").data("kendoGrid").dataSource.data(),{uid:e.model.uid});t.CODE=r,t.DESCRIPTION=l,t.BUSINESS_CONTACT=f,t.BUSINESS_CONTINUITY=s,$("#grid").data("kendoGrid").refresh()}var n={code:e.model.CODE,description:e.model.DESCRIPTION,contact:e.model.BUSINESS_CONTACT,continuity:e.model.BUSINESS_CONTINUITY};a.showDeletePermissionPopup({isConfirm:i,data:n,message:"Are you sure you want to update ?",cancelUpdate:o})},t.getMcps().then(function(i){t.getAllMCPFeedbackCount().then(function(t){var o=_.object(_.pluck(t,"ID"),t);_.each(i,function(e){var t=o[e.CODE];e.COUNT=void 0===t?0:t.COUNT}),e.config.updateGrid(i)},function(t){e.config.updateGrid(i),console.log("mcps feedback Count failed.."+t)})},function(e){console.log("mcps service failed.."+e)}),o.code&&(e.filteredState=!0,e.config.pageable=!1,e.config.dataSource.filter=c.routeParamFilter(o.code))},e.updateFeedbackCount=function(e,t){angular.forEach($("#grid").data().kendoGrid.dataSource.data(),function(i){i.CODE==e&&(i.COUNT=t)});var i=$(".feedbackCount"+e);i.html(t),i.parent().removeClass("hide")},e.filterGridRecord=function(t){var o=i.getConfigs();e.filterGrid(t,o.getDefaultFilterWithFilterText(t))}}])})}();