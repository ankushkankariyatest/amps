!function(){"use strict";define(["assetIt","kendo.all.min","userService","export-util"],function(e){e.register.controller("userController",["$scope","$rootScope","userService","exportUtil","userRoles","popupService",function(t,f,a,r,e,c){var i={schema:{model:{id:"username",fields:{username:{type:"string",editable:!1},fullName:{type:"string",editable:!1},companyName:{type:"string",validation:{notempty:function(e){var t={fullName:"Name is required",companyName:"Company name is required"};return e.attr("data-notempty-msg",t[e.attr("name")]),""==String(e.val()).trim()?!1:!0}}},isAdmin:{type:"boolean"},isEnterprise:{type:"boolean"},isNERC_CIP:{type:"boolean",editable:!1},status:{type:"boolean"}}}},pageSize:20};t.exportToExcel=function(){for(var s=$("#kendo-users").data("kendoGrid"),a=s.dataSource,n=angular.copy(a.filter()),d=a.data(),l=new kendo.data.Query(d),e=l.filter(n).data,t=0;t<e.length;t++)e[t].isAdmin=e[t].isAdmin?"Yes":"No",e[t].isEnterprise=e[t].isEnterprise?"Yes":"No",e[t].isNERC_CIP=e[t].isNERC_CIP?"Yes":"No",e[t].status=e[t].status?"Active":"Inactive";a.filter({}),a.data(e),r.exportToExcel(s);var o=new kendo.data.DataSource(i);o.filter(n),s.setDataSource(o)},t.exportToCsv=function(){for(var s=$("#kendo-users").data("kendoGrid"),a=s.dataSource,n=angular.copy(a.filter()),d=a.data(),l=new kendo.data.Query(d),e=l.filter(n).data,t=0;t<e.length;t++)e[t].isAdmin=e[t].isAdmin?"Yes":"No",e[t].isEnterprise=e[t].isEnterprise?"Yes":"No",e[t].isNERC_CIP=e[t].isNERC_CIP?"Yes":"No",e[t].status=e[t].status?"Active":"Inactive";a.filter({}),a.data(e),r.exportToCsv(s);var o=new kendo.data.DataSource(i);o.filter(n),s.setDataSource(o)},t.initializeController=function(){p(),a.getUserList(m)};var m=function(t){angular.forEach(t,function(t,i){t.isAdmin=t.roles.indexOf(e.admin)>-1,t.isNERC_CIP=t.roles.indexOf(e.nercCip)>-1,t.isEnterprise=t.roles.indexOf(e.enterprise)>-1}),i.data=t;var a=new kendo.data.DataSource(i);$("#kendo-users").data("kendoGrid").setDataSource(a)},p=function(){$("#kendo-users").kendoGrid({sortable:{mode:"single",allowUnsort:!0},filterable:{extra:!1},columns:[{field:"username",title:"Email Address",width:50,filterable:!1},{field:"fullName",title:"Name",width:20,filterable:!1},{field:"isEnterprise",title:"Enterprise Features",width:25,template:function(e){return 1==e.isEnterprise?"Yes":"No"},filterable:{messages:{isTrue:"Yes",isFalse:"No"}}},{field:"isNERC_CIP",title:"BCA Inventory",width:20,template:function(e){return 1==e.isNERC_CIP?"Yes":"No"},filterable:{messages:{isTrue:"Yes",isFalse:"No"}}},{field:"isAdmin",title:"AMPS Admin",width:20,template:function(e){return 1==e.isAdmin?"Yes":"No"},filterable:{messages:{isTrue:"Yes",isFalse:"No"}}},{field:"status",title:"Status",width:50,template:function(e){return 1==e.status?"Active":"Inactive"},filterable:{messages:{isTrue:"Active",isFalse:"Inactive"}}},{title:"Actions",width:50,command:"edit"}],autoBind:!0,scrollable:!1,groupable:!1,pageable:{refresh:!1,input:!0,numeric:!1,pageSize:20,pageSizes:[20,50,100,200]},resizable:!0,editable:"popup",save:function(t){function i(t){var r=t.model.isAdmin,s=t.model.isNERC_CIP,n=t.model.isEnterprise,i=[];r&&i.push(e.admin),s&&i.push(e.nercCip),n&&i.push(e.enterprise),t.model.roles=i,a.updateUserList(t.model)}function r(){var e=_.find($("#kendo-users").data("kendoGrid").dataSource.data(),{uid:t.model.uid});e.isAdmin=n,e.isNERC_CIP=o,e.isEnterprise=d,e.status=s,$("#kendo-users").data("kendoGrid").refresh()}c.showDeletePermissionPopup({isConfirm:i,data:t,message:"Are you sure you want to update ?",cancelUpdate:r})},edit:u,dataBound:function(){var e=$("#txtSearchString").val();e.length>0&&$("#kendo-users tbody").highlight(e)}}).data("kendoGrid")};t.highlightFn=function(e){e&&e.length>0&&($("#kendo-users tbody tr td").highlight(e),$("#kendo-users tbody tr.k-master-row").highlight(e),$("#kendo-users tbody tr.k-detail-row td").highlight(e),$("#kendo-users tbody tr.k-detail-row .assetIT-main-app_details_block").highlight(e))},$("#txtSearchString").bind("input propertychange",function(e){l(),$("#txtSearchString").focus()});var l=function(){var i=$("#txtSearchString").val(),a=$("#kendo-users").data("kendoGrid"),n=a.dataSource.pageSize(),r=a.dataSource.filter(),o={logic:"or",filters:[{field:"username",operator:"contains",value:i},{field:"fullName",operator:"contains",value:i},{field:"companyName",operator:"contains",value:i}]},e=r?r:{filters:[],logic:"and"};for(var s in e.filters)void 0!==e.filters[s].filters&&e.filters.splice(s,1);e.filters.push(o),a.dataSource.filter(e),a.dataSource.pageSize(n),t.highlightFn(i)},n="",o="",d="",s="",u=function(e){e.sender.editable.validatable._errorTemplate=kendo.template($("#errormsg-template").html()),$(".k-edit-form-container").parents("div.k-window").addClass("k-window-custom"),n=e.model.isAdmin,o=e.model.isNERC_CIP,d=e.model.isEnterprise,s=e.model.status}}])})}();